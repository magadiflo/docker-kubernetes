# Secci√≥n 17: Kubernetes: Spring Cloud Kubernetes

---

## ¬øPor qu√© usar Spring Cloud Kubernetes si Kubernetes ya ofrece todo?

Una de las dudas m√°s comunes al comenzar a trabajar con `Spring Boot` en `Kubernetes` es entender si realmente
necesitamos integrar herramientas como `Spring Cloud Kubernetes`, considerando que el propio `Kubernetes` ya
proporciona muchas funcionalidades esenciales de forma nativa, como:

- `Service discovery` mediante `DNS` interno (por ejemplo, `http://orders-service`).
- `Balanceo de carga` a `nivel de red` a trav√©s de los `Services` de tipo `ClusterIP`, `NodePort` o `LoadBalancer`.
- `Configuraci√≥n externa` utilizando `ConfigMaps` y `Secrets`.

Entonces, ¬øpara qu√© agregar una dependencia adicional como `spring-cloud-starter-kubernetes`?

### ‚úÖ Qu√© aporta Spring Cloud Kubernetes

`Spring Cloud Kubernetes` no reemplaza lo que ya hace `Kubernetes`, sino que integra esas capacidades de forma
idiom√°tica dentro del ecosistema `Spring`, facilitando la vida del desarrollador cuando:

1. Queremos mapear `ConfigMaps` y `Secrets` directamente como propiedades de Spring Boot. Con `Spring Cloud Kubernetes`,
   los valores definidos en un `ConfigMap` pueden inyectarse directamente en nuestros componentes con `@Value` o
   `@ConfigurationProperties`, sin necesidad de leer archivos o definir variables de entorno. Por ejemplo.
    ````yml
    apiVersion: v1
    kind: ConfigMap
    metadata:
      name: app-config
    data:
      greeting.message: "Hola desde ConfigMap"
    ````
   ````java
   @Value("${greeting.message}")
   private String message;
   ````
   Sin tener que preocuparte por c√≥mo llegar al `ConfigMap`, Spring lo inyecta.


2. Queremos seguir usando patrones de `Spring Cloud` como `DiscoveryClient`. `Kubernetes` ya ofrece `DNS` para descubrir
   servicios. Sin embargo, si venimos de una arquitectura basada en `Spring Cloud Eureka`, es probable que tengamos
   c√≥digo que usa `DiscoveryClient`. `Spring Cloud Kubernetes` implementa esta interfaz usando la `API de Kubernetes`,
   lo que permite mantener ese c√≥digo sin cambios.


3. Queremos usar `balanceo de carga` del `lado cliente` (`Client-Side Load Balancer`). `Kubernetes` balancea a nivel de
   red, pero `Spring Cloud Kubernetes` permite usar `@LoadBalanced` `RestTemplate` o `WebClient` junto con estrategias
   de balanceo definidas por el cliente (√∫til si queremos reglas m√°s complejas o personalizadas).
   > Cuando hablamos de `load balancing` del `lado del cliente` (`client-side`) nos referimos a que la l√≥gica de elegir
   > a cu√°l instancia de un servicio enviar la solicitud est√° `implementada en el propio cliente` (es decir, en el
   > microservicio que hace la llamada).
   >
   > Esto es diferente al `server-side load balancing`, que es lo que hace `Kubernetes` con sus `Service`, donde el
   > balanceo ocurre de forma transparente a `nivel de red`.


4. Queremos migrar una arquitectura `Spring Cloud` a `Kubernetes`. En proyectos donde ya se usan herramientas como
   `Config Server`, `Eureka` o `Ribbon`, `Spring Cloud Kubernetes` ofrece un puente para migrar sin tener que reescribir
   toda la l√≥gica de integraci√≥n de servicios y configuraci√≥n.

### üîé Entonces, ¬ølo necesito?

No, si...

- Tu aplicaci√≥n es nueva y desarrollada espec√≠ficamente para `Kubernetes`.
- No usas `DiscoveryClient`, `Spring Config Server`, ni necesitas hacer `balanceo de carga` desde el propio
  microservicio (`client-side load balancing`), ya que conf√≠as en que `Kubernetes` manejar√° esto autom√°ticamente a
  nivel de red.
- Est√°s conforme con acceder a configuraci√≥n v√≠a variables de entorno o archivos montados.

S√≠ puede ayudarte, si...

- Est√°s `migrando` desde un stack `Spring Cloud tradicional`.
- Quieres aprovechar las facilidades que ofrece `Spring` para inyectar configuraci√≥n.
- Deseas mantener una `arquitectura desacoplada` de `Kubernetes` en ciertos aspectos.

### üìå En resumen

> Aunque `Spring Cloud Kubernetes no es obligatorio`, s√≠ puede `simplificar la integraci√≥n` entre el mundo de
> `Kubernetes` y el ecosistema `Spring`, especialmente cuando ya est√°s aprovechando otras herramientas de
`Spring Cloud`.

