# Sección 16: Kubernetes: ConfigMap y Secret - Configuración centralizada

---

## [ConfigMaps](https://kubernetes.io/docs/concepts/configuration/configmap/)

Un `ConfigMap` es un *objeto de la API de Kubernetes que se utiliza para almacenar datos de configuración no
confidenciales en forma de pares `clave-valor`*. Los pods pueden consumir un `ConfigMap` de distintas formas:

- Como variables de entorno.
- Argumentos en la línea de comandos.
- Archivos montados dentro del contenedor mediante un volumen.

Los `ConfigMap` permiten desacoplar la configuración específica del entorno del código fuente o de la imagen del
contenedor, facilitando así la portabilidad y reutilización de las aplicaciones entre distintos entornos (desarrollo,
pruebas, producción, etc.).

⚠️ Precaución
> Un `ConfigMap` `no proporciona confidencialidad ni cifrado`. Si necesitas almacenar información sensible (como
> contraseñas, tokens o claves de acceso), debes usar un objeto `Secret`, o bien emplear herramientas adicionales para
> mantener los datos protegidos.

Se recomienda utilizar `ConfigMaps` para mantener la configuración separada del código de la aplicación. Esto promueve
buenas prácticas como el principio de configuración externa, uno de los pilares de las aplicaciones modernas y
escalables.

### Ejemplo práctico

Imagina que estás desarrollando una aplicación que se ejecuta localmente durante el desarrollo y en la nube para el
entorno productivo. En lugar de codificar directamente las direcciones de los servicios, configuras tu aplicación para
que lea una variable de entorno llamada `DATABASE_HOST`.

- En desarrollo local, esa variable podría tener el valor `localhost`.
- En producción, la variable podría apuntar al nombre de un servicio de Kubernetes que expone la base de datos dentro
  del clúster.

Gracias al `ConfigMap`, puedes reutilizar exactamente la misma imagen de contenedor en ambos entornos, modificando
únicamente los valores de configuración.

ℹ️ Nota
> Un `ConfigMap` no está diseñado para almacenar grandes volúmenes de datos. El tamaño total de los datos almacenados no
> debe exceder `1 MiB`. Si necesitas administrar configuraciones más grandes, considera otras alternativas como montar
> un volumen, usar un almacenamiento externo o una base de datos.

## [Secrets](https://kubernetes.io/docs/concepts/configuration/secret/)

Un `Secret` es un *objeto de la API de Kubernetes que se utiliza para almacenar y gestionar información sensible*, como
contraseñas, tokens, claves SSH, certificados u otros datos privados.

Este tipo de objeto permite *evitar incluir datos confidenciales directamente en los manifiestos de los Pods o en las
imágenes de contenedor*, mejorando así la seguridad general de la aplicación y del clúster.

Diferencia clave respecto a `ConfigMaps`
> Aunque los `Secrets` son similares a los `ConfigMaps` en estructura y uso, están específicamente diseñados para
> manejar datos sensibles, con medidas de seguridad adicionales.

### Ventajas del uso de Secrets

- `Separación de responsabilidades`: los secretos pueden definirse y gestionarse de forma independiente al resto de los
  recursos del clúster.
- `Reducción del riesgo de exposición`: como los `Secrets` no necesitan estar embebidos en los `Pods`, se evita que los
  datos sensibles se expongan durante el ciclo de vida del despliegue.
- Tratamiento más seguro: `Kubernetes` puede tomar precauciones adicionales, como evitar que los secretos se escriban en
  disco (dependiendo de la configuración del nodo), o restringir su visibilidad a través de `RBAC`.

### Formas de consumo

Los `Secrets` pueden ser consumidos por los `Pods` de las siguientes maneras:

- Como variables de entorno.
- Montados como archivos dentro de un volumen.
- Referenciados directamente desde las definiciones de contenedores, por ejemplo, para configurar credenciales.

### Consideraciones adicionales

- Por defecto, los datos dentro de un `Secret` están codificados en `Base64`, lo que no implica cifrado real. Se
  recomienda habilitar el cifrado en reposo en el clúster de `Kubernetes` y usar controles de acceso adecuados.
- También se puede integrar `Kubernetes` con soluciones externas de gestión de secretos, como `HashiCorp Vault`,
  `AWS Secrets Manager`, `Azure Key Vault`, entre otros, para obtener mayor control y seguridad.


