# Sección 08: Docker - Comandos para manejar imágenes y contenedores

---

# Comandos para imágenes

----

## Listar imágenes

````bash
$ docker image ls
REPOSITORY     TAG       IMAGE ID       CREATED      SIZE
user-service   latest    9c6a6aca8d0c   2 days ago   407MB
````

## Elimina una imagen (sin especificar tag)

La siguiente instrucción elimina la imagen `user-service`. Como no especificamos una etiqueta en particular, por defecto
elimina el`(TAG)` `latest` que es el tag por defecto. Si la imagen tiene contenedores ejecutándose mostrará mensajes de
error y no podrá eliminarse.

````bash
$ docker image rm user-service
Untagged: user-service:latest
Deleted: sha256:9c6a6aca8d0c7412bf993e849978b3bb8866cf8918b5daf6bedab1b2e138ac82
````

## Elimina una imagen (especificando tag)

La siguiente instrucción elimina la imagen `user-service` con tag `v1`. Si la imagen tiene contenedores ejecutándose
mostrará mensajes de error y no podrá eliminarse.

Primero listamos las imágenes para ver el que eliminaremos.

````bash
$ docker image ls
REPOSITORY     TAG       IMAGE ID       CREATED      SIZE
user-service   v1        00c060ecf18c   2 days ago   407MB
user-service   latest    48b66cc5368c   2 days ago   407MB
````

Ahora sí, eliminamos la imagen `user-service` con tag `v1`.

````bash
$ docker image rm user-service:v1
Untagged: user-service:v1
Deleted: sha256:00c060ecf18c504fd7d30c109e39741df8c341f8f4215520f5527d178d4eda69
````

## Elimina imágenes no utilizadas

Elimina todas las imágenes no usadas o inactivas (dangling images) de Docker. Las imágenes inactivas son imágenes que
no tienen etiquetas y no están asociadas con contenedores en ejecución o detenidos.

````bash
$ docker image prune
````

## Inspecciona imagen

El comando `inspect` muestra información detallada sobre la imagen de Docker. Este comando devuelve
un objeto en formato JSON con una serie de metadatos sobre la imagen, tales como:

- `Id`: El identificador único (ID) de la imagen, representado como un hash.
- `RepoTags`: Las etiquetas de repositorio, como user-service:latest, que identifican la imagen.
- `Created`: La fecha y hora en que la imagen fue creada.
- `ExposedPorts`: Los puertos expuestos en el contenedor, en este caso, 8001/tcp.
- `Env`: Variables de entorno configuradas dentro de la imagen (como la versión de Java).
- `Cmd`: El comando por defecto que se ejecuta cuando el contenedor se inicia (en tu caso, `java`
  `org.springframework.boot.loader.launch.JarLauncher`).
- `Layers`: Una lista de los hashes de las capas de la imagen, que indican cómo se compone la imagen a nivel de sistema
  de archivos.
- `Size`: El tamaño total de la imagen en bytes.
- `GraphDriver`: Información sobre el sistema de almacenamiento utilizado, como overlay2.

Este comando es útil cuando quieres revisar los detalles internos de la imagen, como sus capas, configuración de
puertos, comandos, etc.

````bash
$ docker image inspect user-service
[
    {
        "Id": "sha256:3d6e1ac368580d0d5cae4942c9d5ff8247dedc944a5a17a771293ab1bd0cc944",
        "RepoTags": [
            "user-service:latest"
        ],
        "RepoDigests": [
            "user-service@sha256:3d6e1ac368580d0d5cae4942c9d5ff8247dedc944a5a17a771293ab1bd0cc944"
        ],
        "Parent": "",
        "Comment": "buildkit.dockerfile.v0",
        "Created": "2025-05-23T04:39:46.309349177Z",
        "DockerVersion": "",
        "Author": "",
        "Config": {
            "Hostname": "",
            "Domainname": "",
            "User": "",
            "AttachStdin": false,
            "AttachStdout": false,
            "AttachStderr": false,
            "ExposedPorts": {
                "8001/tcp": {}
            },
            "Tty": false,
            "OpenStdin": false,
            "StdinOnce": false,
            "Env": [
                "PATH=/opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
                "JAVA_HOME=/opt/java/openjdk",
                "LANG=en_US.UTF-8",
                "LANGUAGE=en_US:en",
                "LC_ALL=en_US.UTF-8",
                "JAVA_VERSION=jdk-21.0.7+6"
            ],
            "Cmd": [
                "java",
                "org.springframework.boot.loader.launch.JarLauncher"
            ],
            "ArgsEscaped": true,
            "Image": "",
            "Volumes": null,
            "WorkingDir": "/app",
            "Entrypoint": [
                "/__cacert_entrypoint.sh"
            ],
            "OnBuild": null,
            "Labels": null
        },
        "Architecture": "amd64",
        "Os": "linux",
        "Size": 131600847,
        "GraphDriver": {
            "Data": null,
            "Name": "overlayfs"
        },
        "RootFS": {
            "Type": "layers",
            "Layers": [
                "sha256:08000c18d16dadf9553d747a58cf44023423a9ab010aab96cf263d2216b8b350",
                "sha256:343c5fbeb913f2ca566e329bd1a1a82d1fa9bd4cd3b978600a4bd1f393abf2fd",
                "sha256:d34c6dad4fc84c4d92ab906ddd97ab0f39548bc002093c146705faca0740af73",
                "sha256:002d22842e01692f8f3acfd0d4015ef6340f14c694ea05dc0701328025c2ae7e",
                "sha256:5c70c8580947e31e01c006bf2c3c49d02b5a47019a549982c5040151816fe1ce",
                "sha256:9daa96500800074a04730109aa086bd9e7aa754621634efac81d535178c840de",
                "sha256:e4d29b9ba970f0eef832ee9afdf47739185df59c5b75736fe782a77f4d1b1a76",
                "sha256:6faa915d79865c583eead18a64b01851be4e31983a2b245c80789eb951c6dbb4",
                "sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef",
                "sha256:7a9687dadcf9b637da6b91d3d3899505a90add2870c2f3cd6e9793ff807269bc"
            ]
        },
        "Metadata": {
            "LastTagTime": "2025-05-25T18:10:53.432302378Z"
        },
        "Descriptor": {
            "mediaType": "application/vnd.oci.image.index.v1+json",
            "digest": "sha256:3d6e1ac368580d0d5cae4942c9d5ff8247dedc944a5a17a771293ab1bd0cc944",
            "size": 856
        }
    }
]
````

## Etiqueta imagen

Podemos crear una imagen asignándole una etiqueta (`tag`). Si no le asignamos ninguna etiqueta, por defecto tomará el
valor `latest`. Hasta el momento ya tenemos creado la imagen `user-service` con la etiqueta `latest`, que es la
etiqueta por defecto.

````bash
$ ocker image ls
REPOSITORY     TAG       IMAGE ID       CREATED      SIZE
user-service   latest    3d6e1ac36858   2 days ago   407MB
````

Ahora, crearemos una nueva imagen con la etiqueta `v1`.

````bash
$ D:\programming\spring\01.udemy\02.andres_guzman\08.docker_kubernetes\docker-kubernetes (feature/section-8)                                                                            
$ docker image build -t user-service:v1 .\business-domain\user-service -f .\business-domain\user-service\Dockerfile                                                                   
[+] Building 1.3s (24/24) FINISHED                                                                                                                                docker:desktop-linux
 => [internal] load build definition from Dockerfile                                                                                                                              0.0s
 => => transferring dockerfile: 776B                                                                                                                                              0.0s
 => [internal] load metadata for docker.io/library/eclipse-temurin:21-jre-alpine                                                                                                  1.0s
 => [internal] load metadata for docker.io/library/eclipse-temurin:21-jdk-alpine                                                                                                  1.0s
 => [auth] library/eclipse-temurin:pull token for registry-1.docker.io                                                                                                            0.0s
 => [internal] load .dockerignore                                                                                                                                                 0.0s
 => => transferring context: 214B                                                                                                                                                 0.0s
 => [dependencies 1/9] FROM docker.io/library/eclipse-temurin:21-jdk-alpine@sha256:2f2f553ce09d25e2d2f0f521ab94cd73f70c9b21327a29149c23a2b63b8e29a0                               0.1s
 => => resolve docker.io/library/eclipse-temurin:21-jdk-alpine@sha256:2f2f553ce09d25e2d2f0f521ab94cd73f70c9b21327a29149c23a2b63b8e29a0                                            0.0s
 => [internal] load build context                                                                                                                                                 0.0s
 => => transferring context: 2.98kB                                                                                                                                               0.0s
 => [builder 1/4] FROM docker.io/library/eclipse-temurin:21-jre-alpine@sha256:8728e354e012e18310faa7f364d00185277dec741f4f6d593af6c61fc0eb15fd                                    0.1s
 => => resolve docker.io/library/eclipse-temurin:21-jre-alpine@sha256:8728e354e012e18310faa7f364d00185277dec741f4f6d593af6c61fc0eb15fd                                            0.0s
 => CACHED [builder 2/4] WORKDIR /app                                                                                                                                             0.0s
 => CACHED [dependencies 2/9] WORKDIR /app                                                                                                                                        0.0s
 => CACHED [dependencies 3/9] COPY ./mvnw ./                                                                                                                                      0.0s
 => CACHED [dependencies 4/9] COPY ./.mvn ./.mvn                                                                                                                                  0.0s
 => CACHED [dependencies 5/9] COPY ./pom.xml ./                                                                                                                                   0.0s
 => CACHED [dependencies 6/9] RUN sed -i -e 's/\r$//' ./mvnw                                                                                                                      0.0s
 => CACHED [dependencies 7/9] RUN ./mvnw dependency:go-offline                                                                                                                    0.0s
 => CACHED [dependencies 8/9] COPY ./src ./src                                                                                                                                    0.0s
 => CACHED [dependencies 9/9] RUN ./mvnw clean package -DskipTests                                                                                                                0.0s
 => CACHED [builder 3/4] COPY --from=dependencies /app/target/*.jar ./app.jar                                                                                                     0.0s
 => CACHED [builder 4/4] RUN java -Djarmode=layertools -jar app.jar extract                                                                                                       0.0s
 => CACHED [runner 3/6] COPY --from=builder /app/dependencies ./                                                                                                                  0.0s
 => CACHED [runner 4/6] COPY --from=builder /app/spring-boot-loader ./                                                                                                            0.0s
 => CACHED [runner 5/6] COPY --from=builder /app/snapshot-dependencies ./                                                                                                         0.0s
 => CACHED [runner 6/6] COPY --from=builder /app/application ./                                                                                                                   0.0s
 => exporting to image                                                                                                                                                            0.1s
 => => exporting layers                                                                                                                                                           0.0s
 => => exporting manifest sha256:f8469b8029893ffb33a7c126ba7bed43af855044a9376ea4e9266c8452399dec                                                                                 0.0s
 => => exporting config sha256:31201a78d21650ee023e12e4e3a977910e595c45687666334f344bf327d0b476                                                                                   0.0s
 => => exporting attestation manifest sha256:1a2abc9aaf817736362547571e12cb99121ec21ff8bf41a1237771e8628d89ed                                                                     0.0s
 => => exporting manifest list sha256:3b3a3c4b45f5c4a24b4d2c0d9f39a15cb3a50b2cb8da6ed4d65581e2c267b637                                                                            0.0s
 => => naming to docker.io/library/user-service:v1                                                                                                                                0.0s
 => => unpacking to docker.io/library/user-service:v1                                                                                                                             0.0s
                                                                                                                                                                                      
View build details: docker-desktop://dashboard/build/desktop-linux/desktop-linux/xffy50yhagfhtjzzwankr1rii
````

Si listamos las imágenes veremos que ahora tenemos dos versiones, la imagen con etiqueta `latest` y `v1`.

````bash
$ docker image ls
REPOSITORY     TAG       IMAGE ID       CREATED      SIZE
user-service   latest    3d6e1ac36858   2 days ago   407MB
user-service   v1        3b3a3c4b45f5   2 days ago   407MB
````

## Renombra etiqueta de imagen

El comando para renombrar la etiqueta de una imagen en Docker es `docker image tag`. Este comando permite asignar una
nueva etiqueta (o `tag`) a una imagen existente, lo cual es equivalente a renombrarla.

Listamos para verificar las imágenes y etiquetas que tenemos.

````bash
$ docker image ls
REPOSITORY     TAG       IMAGE ID       CREATED      SIZE
user-service   latest    3d6e1ac36858   2 days ago   407MB
user-service   v1        3b3a3c4b45f5   2 days ago   407MB
````

A continuación, asignaremos una nueva etiqueta a la imagen `user-service:latest`, de forma que también esté disponible
como `magadiflo/user-service:v2`.

````bash
$ docker image tag user-service:latest magadiflo/user-service:v2
````

Después de ejecutar el comando anterior, listamos las imágenes para comprobar la existencia de la nueva etiqueta.

````bash
$ docker image ls
REPOSITORY               TAG       IMAGE ID       CREATED      SIZE
user-service             latest    3d6e1ac36858   2 days ago   407MB
magadiflo/user-service   v2        3d6e1ac36858   2 days ago   407MB
user-service             v1        3b3a3c4b45f5   2 days ago   407MB
````

Como se puede observar, no se ha creado una nueva imagen, sino que se ha generado una nueva etiqueta
(`magadiflo/user-service:v2`) que apunta al mismo `ID de imagen` (`3d6e1ac36858`). Es decir, ahora la misma imagen
tiene múltiples nombres o etiquetas asociadas.

