# Secci칩n 14: Kubernetes

---

## Introducci칩n

### [Kubernetes vs Docker Compose](https://www.theserverside.com/blog/Coffee-Talk-Java-News-Stories-and-Opinions/What-is-Kubernetes-vs-Docker-Compose-How-these-DevOps-tools-compare)

`Kubernetes y Docker Compose` **son marcos de orquestaci칩n de contenedores.**

- `Docker Compose` ejecuta contenedores en un 칰nico equipo anfitri칩n.
- `Kubernetes` ejecuta contenedores en varios ordenadores, virtuales o reales.

![01.png](assets/section-14/01.png)

`Entendiendo Docker Compose`, como se mencion칩 anteriormente, Docker Compose es una tecnolog칤a de orquestaci칩n de
contenedores que est치 destinada a ejecutar una serie de contenedores en una sola m치quina host. Los desarrolladores
crean un archivo Docker Compose que describe las im치genes de contenedor y la configuraci칩n con la que se compone el
Docker Compose. El nombre de este archivo es `compose.yml` o para versiones anteriores `docker-compose.yml`.

`Entendiendo Kubernetes`, como se ha mencionado anteriormente, Kubernetes es una tecnolog칤a de orquestaci칩n de
contenedores. Bajo Kubernetes, la l칩gica de una aplicaci칩n web se segmenta en contenedores. Los contenedores se
organizan en una abstracci칩n llamada pod. Un pod puede tener uno o varios contenedores. La l칩gica de un pod se expone
a la red a trav칠s de otra abstracci칩n de Kubernetes denominada servicio. En resumen, la red conoce los servicios de
Kubernetes y un servicio conoce el pod o los pods que tienen su l칩gica. Dentro de cada pod hay uno o varios
contenedores que realizan la l칩gica del pod en cuesti칩n (Ver figura de abajo).

Un servicio de Kubernetes expone la l칩gica de los contenedores de un pod a la red.

![02.png](assets/section-14/02.png)

En `Kubernetes`, los contenedores, pods y servicios se alojan dentro de una colecci칩n de uno o varios equipos, reales
o virtuales. En la jerga de `Kubernetes`, `un ordenador se denomina nodo`. `Kubernetes` se ejecuta en varios nodos.
La colecci칩n de nodos se denomina `cl칰ster de Kubernetes`.

Los pods y los contenedores asociados a un servicio se pueden alojar en varios equipos. Adem치s, Kubernetes tiene
caracter칤sticas de escalado y tolerancia a errores que hacen que Kubernetes pueda crear autom치ticamente m치s pods en
tiempo de ejecuci칩n para satisfacer el aumento de la demanda sin p칠rdida de servicio. Adem치s, si un pod falla,
Kubernetes lo repondr치 autom치ticamente. Docker Compose admite reinicios autom치ticos en caso de error, pero no est치
dise침ado para admitir el escalado autom치tico.

Lo importante que hay que entender sobre la diferencia entre Docker Compose es que, mientras que en Docker Compose, un
contenedor y su servicio y red correspondientes se ejecutan en una sola m치quina, en Kubernetes los contenedores se
organizan seg칰n una abstracci칩n llamada pod. Un pod puede ser utilizado por uno o varios servicios, y los pods asociados
a un solo servicio suelen estar distribuidos en varios equipos.

### [쯈u칠 es Kubernetes?](https://kubernetes.io/es/docs/concepts/overview/what-is-kubernetes/)

`Kubernetes (K8s)` es una plataforma de c칩digo abierto para automatizar la implementaci칩n, el escalado y la
administraci칩n de aplicaciones en contenedores.

El despliegue de contenedores con `Kubernetes` pueden ayudarnos de mejor forma y m치s estandarizada.

- `Revisi칩n de salud (health check) del contenedor y re-deploy`, los contenedores pueden fallar y detenerse, se pueden
  caer y necesitan ser reemplazados.
- `Autoescalado (Autoscaling)`, necesitamos escalar nuestros servicios seg칰n aumenta o disminuye el tr치fico.
- `Balanceo de carga (Load Balancer)`, distribuir uniformemente el tr치fico entrante o carga de trabajo entre los
  contenedores.

`Kubernetes` provee configuraci칩n estandarizada, archivos de manifiesto `yml`, contenedores, n칰meros de instancias,
servicios, puertos, recursos, etc.

- Se puede llevar a cualquier proveedor en la nube como `Amazon EKS`, `Microsoft Azure`, `Google Cloud`, etc.
- O bien, se puede configurar en m치quinas remotas o data centers administrador por nosotros, por ejemplo `VPS`.

游닉 **IMPORTANTE**

> `Kubernetes` no es un servicio en la nube, sino m치s bien, es un software que podemos instalar y configurar en la nube
> ya sea en una m치quina remota que administraremos nosotros (Ejm. EC2, alg칰n otro VPS, etc), es decir, al igual que
> hicimos con `Docker` cuando usamos `Amazon EC2`, tambi칠n podemos hacer lo mismo con `Kubernetes`, instalar y
> configurarlo, de forma que sea auto-administrada por nosotros.
>
> Por lo tanto, `Kubernetes` no es un proveedor de servicio, es un `framework` que nos ayuda en el despliegue de
> contenedores de forma automatizada con **revisi칩n de salud, re-deploy, auto-escalamiento, balanceo de carga.**
>
> Podemos usar `Kubernetes` en `Amazon`, `Azure`, `Google Cloud`, etc.

## Conceptos Arquitect칩nicos detr치s de Kubernetes

Un `cl칰ster de Kubernetes` consta de un `control plane` y un conjunto de `m치quinas de trabajo`, llamadas `nodos`, que
ejecutan aplicaciones en contenedores. Cada cl칰ster necesita al menos un nodo de trabajo para ejecutar `pods`.

Los `nodos de trabajo` alojan los `pods` que componen la carga de trabajo de la aplicaci칩n. El `control plane`
administra los `nodos de trabajo` y los `pods` del cl칰ster. En entornos de producci칩n, el `control plane` suele
ejecutarse en varios equipos y un cl칰ster suele ejecutar varios nodos, lo que proporciona tolerancia a fallos y alta
disponibilidad.

Este documento describe los diversos componentes necesarios para un `cl칰ster de Kubernetes` completo y funcional.

![04.png](assets/section-14/04.png)

### 游 Componentes del control plane

Los componentes del plano de control toman decisiones globales sobre el cl칰ster (por ejemplo, el scheduling), adem치s de
detectar y responder a eventos del cl칰ster (por ejemplo, iniciar un nuevo pod cuando el campo de r칠plicas de una
implementaci칩n no est치 satisfecho).

Los componentes del plano de control se pueden ejecutar en cualquier equipo del cl칰ster. Sin embargo, para simplificar,
los scripts de configuraci칩n suelen iniciar todos los componentes del plano de control en el mismo equipo y no ejecutan
contenedores de usuario en este.

### 游 Kube-apiserver

El `API Server` es un componente del plano de control de Kubernetes que expone la API de Kubernetes. El API server es
la interfaz del plano de control de Kubernetes.

La implementaci칩n principal de un API Server de Kubernetes es `kube-apiserver`. `Kube-apiserver` est치 dise침ado para
escalar horizontalmente; es decir, escala mediante la implementaci칩n de m치s instancias. Se pueden ejecutar varias
instancias de `kube-apiserver` y equilibrar el tr치fico entre ellas.Almac칠n de valores clave consistente y de alta
disponibilidad que se utiliza como almac칠n de respaldo de Kubernetes para todos los datos del cl칰ster.

### 游 Etcd

Almac칠n de valores clave consistente y de alta disponibilidad que se utiliza como almac칠n de respaldo de `Kubernetes`
para todos los datos del cl칰ster.

Si su cl칰ster de Kubernetes utiliza etcd como almac칠n de respaldo, aseg칰rese de contar con un plan de respaldo para los
datos.

### 游 kube-scheduler

Es el componente del control plane encargado de asignar los `Pods` reci칠n creados (que a칰n no est치n asignados a ning칰n
nodo) a un nodo disponible del cl칰ster.

El scheduler eval칰a varios factores como: uso de recursos, afinidad/anti-afinidad, restricciones de nodo, tolerancias y
m치s, para decidir en qu칠 nodo es m치s adecuado ejecutar ese Pod.

### 游 kube-controller-manager

Es el componente que se encarga de ejecutar varios controladores (programas que vigilan el estado del cl칰ster) en un
solo proceso.

Algunos de los controladores m치s importantes son:

- Node Controller: monitorea el estado de los nodos.
- Replication Controller: garantiza que el n칰mero deseado de r칠plicas de un Pod est칠 siempre corriendo.
- Endpoints Controller: gestiona los objetos Endpoint para servicios.
- Service Account & Token Controllers: maneja cuentas de servicio y tokens de acceso.

En resumen, el `kube-controller-manager` se asegura de que el estado real del cl칰ster coincida con el estado deseado
definido en las configuraciones de Kubernetes.

### 游 cloud-controller-manager

Es un componente del `control plane` que permite que `Kubernetes` interact칰e con los proveedores de nube (como `AWS`,
`GCP`, `Azure`).

Se encarga de separar la l칩gica espec칤fica del proveedor de nube del resto del cl칰ster. Algunas de sus funciones
incluyen:

- Gestionar nodos seg칰n la infraestructura de nube (por ejemplo, eliminar nodos apagados).
- Asignar IPs externas a servicios.
- Crear balanceadores de carga (load balancers).

Solo es necesario si el cl칰ster corre en un entorno de nube.

### 游 Componentes del Nodo (Node components)

Son los procesos que se ejecutan en cada `nodo del cl칰ster` y se encargan de que los `Pods` funcionen correctamente.
Incluyen:

- `kubelet`: Agente que se comunica con el control plane, ejecuta los `Pods` en el nodo y reporta su estado.
- `kube-proxy`: Maneja la red en cada nodo, configurando reglas de red para permitir la comunicaci칩n entre `Pods` y
  `Servicios`.
- `Container Runtime`: Software que ejecuta los contenedores (por ejemplo, `containerd`, `CRI-O` o `Docker`).

Estos componentes son esenciales para que cada nodo participe activamente en el `cl칰ster de Kubernetes`.

### 游 kubelet

Un agente que se ejecuta en cada nodo del cl칰ster. Garantiza que los contenedores se ejecuten en un pod.

`Kubelet` toma un conjunto de `PodSpecs` proporcionados mediante diversos mecanismos y garantiza que los contenedores
descritos en ellas se ejecuten correctamente. Kubelet no administra contenedores que no hayan sido creados por
Kubernetes.

### 游 Container runtime

Un componente fundamental que permite a `Kubernetes` ejecutar contenedores eficazmente. Se encarga de gestionar la
ejecuci칩n y el ciclo de vida de los contenedores dentro del entorno de `Kubernetes`.

A continuaci칩n se muestra el diagrama de la arquitectura de kubernetes mostrado en el curso.

![03.png](assets/section-14/03.png)

游닇 **NOTA**

- `Minikube` es una herramienta que nos permite crear un cl칰ster local de `Kubernetes` en nuestra m치quina. Es ideal para
  desarrollo y pruebas, ya que simula un entorno de cl칰ster real.


- `kubectl` (**abreviatura de Kubernetes control**) es la `herramienta de l칤nea de comandos` para interactuar con un
  cl칰ster de `Kubernetes`. Permite ejecutar comandos para desplegar aplicaciones, inspeccionar recursos y administrar el
  cl칰ster. Funciona tanto con `minikube` en entornos locales como con cl칰steres remotos en la nube (por ejemplo,
  en `Amazon EKS`, `Google GKE`, `Azure AKS`, etc.).
